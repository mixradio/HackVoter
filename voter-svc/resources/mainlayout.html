<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hack Voter</title>
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/css/reset.css">
  <link rel="stylesheet" href="/assets/css/styles.css">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
</head>
<body>
  <div class="container-outer">
    <div class="container-inner">
      <div class="container-logo">
        <a href="/"><img class="logo" src="/assets/img/logo.svg" alt="Hack Voter"/></a>
      </div>
      <div class="blurb">{TITLE}</div>
      <div class="blurb">
{CONTENT}
      </div>
    </div>
  </div>
  <script type="text/javascript">
    if(allowvoting) {
      var votes = null;
      var votesused = 0;

      $.ajax({ url: "/votes"}).done(function(data) {
        votes = data;
        updatevotes();
      });

      function updatevotes() {
        votesused = 0;
        for(var i=0;i<votes.length;i++) {
          var id = votes[i].id;
          var votecount = votes[i].uservotes;
          var votediv = $('#' + id).find(".uservote");
          votesused += votecount;
          votediv.html(votecount);
        }
        updatevotefloater(votesused);
      }

      function vote(id, vote) {
        var newtotalvotes = votesused + vote;
        if(newtotalvotes > allocation) {
          return;
        }
        for (var i=0;i<votes.length;i++) {
          var voteitem = votes[i];
          if(id == voteitem.id) {
            var newvote = voteitem.uservotes + vote;
            if(newvote < 0) {
              newvote = 0;
            }
            else if(newvote > maxspend) {
              newvote = maxspend;
            }
            voteitem.uservotes = newvote;
          }
        }
        updatevotes();
      }

      function updatevotefloater(votesused) {
        if(allowvoting) {
          $('#uservotefloater').html("You have used " + votesused + " out of your " + allocation + " " + currency);
          $('#uservotefloater').show();
        }
      }
    }

    function confirmdelete(title, deleteuri) {
      if(confirm('Are you sure you want to delete "' + title + '"?')) {
        window.location=deleteuri;
      }
    }
  </script>
</body>
</html>
